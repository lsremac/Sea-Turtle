<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TurtleQuest Asset Test</title>
  
  <!-- Phaser 3 -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
  
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 20px; 
      background: #071e26; 
      color: white; 
    }
    .test-section { 
      margin: 20px 0; 
      padding: 15px; 
      border: 1px solid #00ffd0; 
      border-radius: 8px; 
    }
    .success { color: #00ffd0; }
    .error { color: #ff6b6b; }
    .warning { color: #fdcb6e; }
    #game-container {
      width: 800px;
      height: 600px;
      border: 2px solid #00ffd0;
      margin: 20px auto;
      background: #000;
      position: relative;
      overflow: hidden;
    }
    
    /* Debug: Make sure we can see the container */
    #game-container::before {
      content: 'GAME CONTAINER - 800x600';
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      background: rgba(0,0,0,0.8);
      padding: 5px;
      font-size: 12px;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <h1>üê¢ TurtleQuest Asset Test</h1>
  
  <div class="test-section">
    <h2>Asset Loading Test</h2>
    <div id="test-results"></div>
  </div>

  <div class="test-section">
    <h2>Game Display Test</h2>
    <div id="game-container"></div>
  </div>

  <div class="test-section">
    <h2>Console Output</h2>
    <div id="console-output" style="background: #000; padding: 10px; border-radius: 4px; font-family: monospace; height: 200px; overflow-y: auto;"></div>
  </div>

  <script>
    // Capture console output
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;
    
    const consoleOutput = document.getElementById('console-output');
    const testResults = document.getElementById('test-results');
    
    function addToConsole(type, message) {
      const div = document.createElement('div');
      div.style.color = type === 'error' ? '#ff6b6b' : type === 'warn' ? '#fdcb6e' : '#00ffd0';
      div.textContent = `[${type.toUpperCase()}] ${message}`;
      consoleOutput.appendChild(div);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      addToConsole('log', args.join(' '));
    };
    
    console.error = function(...args) {
      originalError.apply(console, args);
      addToConsole('error', args.join(' '));
    };
    
    console.warn = function(...args) {
      originalWarn.apply(console, args);
      addToConsole('warn', args.join(' '));
    };
    
    // IMMEDIATE TEST: Create a simple game right now
    function createImmediateTest() {
      try {
        console.log('=== IMMEDIATE TEST STARTING ===');
        addToConsole('log', 'Creating immediate test game...');
        
        const simpleConfig = {
          type: Phaser.CANVAS,
          width: 400,
          height: 300,
          parent: 'game-container',
          backgroundColor: '#00ff00', // Bright green
          scene: {
            create: function() {
              console.log('Immediate test create function called!');
              addToConsole('success', 'Immediate test working!');
              
              // Draw a simple blue circle
              this.add.circle(200, 150, 50, 0x0000ff);
              
              // Add text
              this.add.text(200, 150, 'TEST', { 
                fontSize: '24px', 
                fill: '#ffffff' 
              }).setOrigin(0.5);
              
              console.log('Immediate test shapes drawn!');
            }
          }
        };
        
        const immediateGame = new Phaser.Game(simpleConfig);
        console.log('Immediate test game created:', immediateGame);
        addToConsole('success', 'Immediate test game created successfully!');
        
      } catch (error) {
        console.error('Immediate test failed:', error);
        addToConsole('error', `Immediate test failed: ${error.message}`);
      }
    }
    
    // Try to create the immediate test as soon as Phaser loads
    if (typeof Phaser !== 'undefined') {
      console.log('Phaser already loaded, running immediate test...');
      createImmediateTest();
    } else {
      console.log('Waiting for Phaser to load...');
      // Wait for Phaser to load
      const checkPhaser = setInterval(() => {
        if (typeof Phaser !== 'undefined') {
          clearInterval(checkPhaser);
          console.log('Phaser loaded, running immediate test...');
          createImmediateTest();
        }
      }, 100);
    }
    
    // Simple asset test
    function testAssets() {
      const results = [];
      
      try {
        // Test 1: Check if Phaser is available
        if (typeof Phaser === 'undefined') {
          results.push({ test: 'Phaser Library', status: 'error', message: 'Phaser library not loaded' });
        } else {
          results.push({ test: 'Phaser Library', status: 'success', message: 'Phaser library loaded successfully' });
        }
        
        // Test 2: Check if classes are defined
        if (typeof GameManager === 'undefined') {
          results.push({ test: 'GameManager Class', status: 'error', message: 'GameManager class not found' });
        } else {
          results.push({ test: 'GameManager Class', status: 'success', message: 'GameManager class loaded successfully' });
        }
        
        if (typeof TurtlePlayer === 'undefined') {
          results.push({ test: 'TurtlePlayer Class', status: 'error', message: 'TurtlePlayer class not found' });
        } else {
          results.push({ test: 'TurtlePlayer Class', status: 'success', message: 'TurtlePlayer class loaded successfully' });
        }
        
        displayResults(results);
        
        // If everything is loaded, try to create a simple game scene
        if (typeof Phaser !== 'undefined' && typeof GameManager !== 'undefined') {
          createSimpleGame();
        }
        
      } catch (error) {
        results.push({ test: 'Test Execution', status: 'error', message: `Test execution failed: ${error.message}` });
        displayResults(results);
      }
    }
    
    function displayResults(results) {
      testResults.innerHTML = '';
      results.forEach(result => {
        const div = document.createElement('div');
        div.className = result.status;
        div.innerHTML = `<strong>${result.test}:</strong> ${result.message}`;
        testResults.appendChild(div);
      });
    }
    
    // Create a simple game scene to test assets
    function createSimpleGame() {
      try {
        console.log('About to create Phaser game...');
        
        const config = {
          type: Phaser.CANVAS, // Force Canvas renderer
          width: 800,
          height: 600,
          parent: 'game-container',
          backgroundColor: '#ff0000', // Bright red background to make sure we see something
          render: {
            pixelArt: false,
            antialias: true
          },
          scene: {
            preload: function() {
              console.log('Preload function called');
            },
            create: function() {
              console.log('Create function called - drawing shapes...');
              
              // Create a simple ocean background (blue rectangle) - make it HUGE
              const bg = this.add.rectangle(400, 300, 800, 600, 0x006994);
              console.log('Background created:', bg);
              
              // Create a simple turtle (green rectangle) - make it BIG
              const turtle = this.add.rectangle(400, 300, 100, 100, 0x00ff00);
              console.log('Turtle created:', turtle);
              
              // Create some trash items (red rectangles) - make them BIG
              const trash1 = this.add.rectangle(200, 200, 50, 50, 0xff0000);
              const trash2 = this.add.rectangle(600, 400, 50, 50, 0xff0000);
              console.log('Trash items created:', trash1, trash2);
              
              // Create a hazard (orange rectangle) - make it BIG
              const shark = this.add.rectangle(100, 100, 80, 80, 0xff6600);
              console.log('Shark created:', shark);
              
              // Create a powerup (yellow rectangle) - make it BIG
              const powerup = this.add.rectangle(700, 500, 60, 60, 0xffff00);
              console.log('Powerup created:', powerup);
              
              // Add some text labels - make them HUGE
              const titleText = this.add.text(400, 50, 'TURTLEQUEST TEST', { 
                fontSize: '48px', 
                fill: '#ffffff',
                stroke: '#000000',
                strokeThickness: 4
              }).setOrigin(0.5);
              console.log('Title text created:', titleText);
              
              const successText = this.add.text(400, 120, 'SHAPES LOADED!', { 
                fontSize: '32px', 
                fill: '#00ff00',
                stroke: '#000000',
                strokeThickness: 3
              }).setOrigin(0.5);
              console.log('Success text created:', successText);
              
              const loadingText = this.add.text(400, 180, 'LOADING PNG ASSETS...', { 
                fontSize: '24px', 
                fill: '#ffff00',
                stroke: '#000000',
                strokeThickness: 2
              }).setOrigin(0.5);
              console.log('Loading text created:', loadingText);
              
              // Debug: Check what's in the scene
              console.log('Scene children count:', this.children.length);
              console.log('Scene children:', this.children.list);
              
              // Debug: Check camera
              console.log('Camera position:', this.cameras.main.scrollX, this.cameras.main.scrollY);
              console.log('Camera zoom:', this.cameras.main.zoom);
              
              console.log('Simple shapes created successfully!');
              addToConsole('success', 'Simple shapes created - game logic works!');
              
              // Now try to load the PNG assets
              this.loadAssets();
              
            },
            loadAssets: function() {
              console.log('Attempting to load PNG assets...');
              
              // Try to load the PNG assets
              this.load.spritesheet('turtle', 'assets/turtle-sheet.png', { 
                frameWidth: 32, 
                frameHeight: 32 
              });
              this.load.image('background', 'assets/background.png');
              this.load.spritesheet('trash-items', 'assets/trash-items.png', { 
                frameWidth: 16, 
                frameHeight: 16 
              });
              this.load.spritesheet('hazards', 'assets/hazards.png', { 
                frameWidth: 24, 
                frameHeight: 24 
              });
              this.load.spritesheet('powerups', 'assets/powerups.png', { 
                frameWidth: 16, 
                frameHeight: 16 
              });
              
              // Set up load events
              this.load.on('complete', () => {
                console.log('All PNG assets loaded successfully!');
                addToConsole('success', 'PNG assets loaded successfully!');
                this.replaceWithPNGAssets();
              });
              
              this.load.on('loaderror', (file) => {
                console.error('Failed to load asset:', file.src);
                addToConsole('error', `Failed to load: ${file.src}`);
              });
              
              // Start loading
              this.load.start();
            },
            replaceWithPNGAssets: function() {
              console.log('Replacing shapes with PNG assets...');
              
              // Clear the scene
              this.children.removeAll(true);
              
              // Add PNG background
              this.add.image(400, 300, 'background');
              
              // Add PNG turtle with animation
              const turtle = this.add.sprite(400, 300, 'turtle');
              
              // Create turtle animation
              this.anims.create({
                key: 'turtle-swim',
                frames: this.anims.generateFrameNumbers('turtle', { start: 0, end: 3 }),
                frameRate: 8,
                repeat: -1
              });
              
              turtle.play('turtle-swim');
              
              // Add PNG trash items
              const trash1 = this.add.sprite(200, 200, 'trash-items', 0);
              const trash2 = this.add.sprite(600, 400, 'trash-items', 1);
              
              // Add PNG hazard
              const shark = this.add.sprite(100, 100, 'hazards', 0);
              
              // Add PNG powerup
              const powerup = this.add.sprite(700, 500, 'powerups', 0);
              
              // Add success message
              this.add.text(400, 50, 'üéâ PNG Assets Working! üéâ', { 
                fontSize: '24px', 
                fill: '#00ff00' 
              }).setOrigin(0.5);
              
              addToConsole('success', 'PNG assets displayed successfully!');
            }
          }
        };
        
        const game = new Phaser.Game(config);
        
        // Add error handling
        game.events.on('error', (error) => {
          console.error('Game error:', error);
          addToConsole('error', `Game error: ${error.message}`);
        });
        
        // Check if WebGL failed and try Canvas
        if (game.renderer.type === Phaser.WEBGL) {
          console.log('WebGL renderer active');
        } else if (game.renderer.type === Phaser.CANVAS) {
          console.log('Canvas renderer active (WebGL failed)');
        }
        
      } catch (error) {
        console.error('Failed to create game:', error);
        addToConsole('error', `Failed to create game: ${error.message}`);
        
        // Try with Canvas renderer as fallback
        try {
          console.log('Trying Canvas renderer as fallback...');
          const fallbackConfig = {
            ...config,
            type: Phaser.CANVAS
          };
          const fallbackGame = new Phaser.Game(fallbackConfig);
          addToConsole('success', 'Game created with Canvas renderer!');
        } catch (fallbackError) {
          console.error('Canvas fallback also failed:', fallbackError);
          addToConsole('error', `Canvas fallback failed: ${fallbackError.message}`);
        }
      }
    }
    
    // Load the game scripts
    const scripts = [
      'js/game-manager.js',
      'js/entities/turtle-player.js'
    ];
    
    let loadedScripts = 0;
    
    scripts.forEach(script => {
      const scriptElement = document.createElement('script');
      scriptElement.src = script;
      scriptElement.onload = () => {
        loadedScripts++;
        if (loadedScripts === scripts.length) {
          console.log('Core scripts loaded, testing assets...');
          setTimeout(testAssets, 500);
        }
      };
      scriptElement.onerror = () => {
        console.error(`Failed to load script: ${script}`);
        loadedScripts++;
        if (loadedScripts === scripts.length) {
          setTimeout(testAssets, 500);
        }
      };
      document.head.appendChild(scriptElement);
    });
  </script>
</body>
</html>
